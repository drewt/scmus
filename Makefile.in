prefix = @prefix@
exec_prefix = @exec_prefix@
datarootdir = @datarootdir@
bindir = @bindir@
datadir = @datadir@
mandir = @mandir@

LIBS = @NCURSES_LIBS@

features-@CONFIG_WIDE_CHAR@ += -feature wide-char

prelude = '"(define *scmus-dir* \"$(datadir)/scmus\")\
	    (define *version*   \"@PACKAGE_VERSION@\")"'

CSC      = csc
CSCFLAGS = -scrutinize -C -Wno-int-to-pointer-cast -C -Wno-cpp -uses lib \
	   -prologue prologue.scm $(features-y)
LD       = csc
LDFLAGS  =
INSTALL  = @scripts/install

eggs = sandbox unix-sockets utf8

units = bindings-view browser-view config command-line editable eval-mode \
	event format getopt input keys lib library-view main mpd-client \
	ncurses option options-view queue-view search-view scmus-client \
	ui-curses ui-lib view window
objects = $(foreach unit,$(units),$(addsuffix .@OBJEXT@,$(unit)))
target = scmus@EXEEXT@

clean = $(objects) $(target)

all: $(target)

include rules.mk

config.o: CSCFLAGS += -prelude $(prelude)

$(target): $(objects)
	$(call cmd,ld,$(LIBS))

eggs:
	chicken-install $(eggs)

install: all
	$(INSTALL) -m755 $(bindir) scmus
	$(INSTALL) -m644 $(datadir)/scmus data/scmusrc.scm
	$(INSTALL) -m644 $(datadir)/scmus/colors $(wildcard data/colors/*)
	$(INSTALL) -m644 $(mandir)/man1 $(wildcard doc/*.1)
